# MLE_for_2nd_price_auction_supp_data
Supplement codes and data for paper A non-parametric approach for estimating consumer valuation distributions using second price auctions.

## The structure of folders:

MLE_2ndprice_code: contain all R files and data
  SIMU: all simulation results in RData
  Empirical: all results about XBox dataset on Ebay, RData and file
  Plots: all plots and relevant RData

## Explanation of R files:

#### Under MLE_2ndprice_code folder:
  DataGeneration.R: functions to generate auctions with all unobserved bids and (seal-price) 2nd-price auctions with only observed bidds, used for MLE, Init and PT estimate. Also contain functions to slice dataset.
                    It is also used to generate results in Empirical study to calculate MSE.
  Main.R: definition of MLE and initial estimate function, and important function used by them (e.g. step-wise update function). Also include F_fp separately, and the 2-step MLE used in Supplement S4.
  Initialization_lambda_F_Simp.R: definition of the simplified Init estimate function only used in Supplement S.4.
  PT_MCMC.R: Polya Tree (PT) estimate function (from personal communication with Prof. Hui), as well as an interface function to accomodate the format of dataset we used.

  distributions.R: Contain some distributions defined by us, include piecewise uniform CDF, and the important log-likelihood_PA function of 2nd-price auction model in (3.3)
  SettingGeneration.R: auxiliary file, define all settings in Simulations, e.g. the parameters of F_0 and reserve prices. 
  DisCompare.R: auxiliary file, include package and R function to compare the KS divergence and TV distance, as well as linear interpolation cdf used in AbscontDistribution class.

  HulC_main.R: main functions to calculate the HulC interval for MLE and Init.

  Simu1.R: main function to conduct (one of) the simulation in Table 2 (comparison of MLE, Init and PT estimate on KS and TV, with K=100 and 1000; originally Table 1)
  Simu1_Table.R: automatically conducts all simulations correspond to the previous file with different settings and present Table 2.

  Simu2_HulC_Coverage.R:  main function to conduct (one of) the simulation in Table 3 (comparison of HulC band of MLE, Init and credible band of PT on band area and coverage, with K=100 and 1000; originally Table2)
  Simu2_Table.R: automatically conducts all simulations correspond to the previous file with different settings and present Table 3.

  Simu1_2_morebidder.R:  main function to conduct (one of) the simulation in Table S.1 in Supplement S.4 (comparison of MLE, Init and PT estimate on KS and TV, with lambda=10 and 50)
  Simu1_2_Table.R: automatically conducts all simulations correspond to the previous file with different settings and present Table S.1.

#### Under Empirical folder (and their plots):
  XBOX_Pre.R: extract organized data from a real (raw) Xbox Auctions data set and covert to our format.
  MSE_selling_price.R: function to fit models on train set, and generate the final selling price on test set and compare to the true value in MSE. Corresponding to Table 4. Note the PT here uses estimated result from MLE for the unknown total number of bidders.
  HulC_XBOX.R: function to generate result curves and HulC bands in the whole dataset.
    Results saved in HulC_XBOX_all.pdf.
    
  check_seq_auc.R: function to check the multiple-bidding issue.
  dis_selling_price.R: comparison of the final selling price generated by each methods, and calculate the The Average Overlap Ratio and the Average Range Ratio for each methods. Not used in the paper, just for reference. Further investigate shows heterogeneity in some of the XBOX products which cannot be explained by observed bid only.

#### Under Plots folder (and their plots):
  Instability_Boundary_Correction.R: 2 functions, one shows the instability on boundary due to the non-identifiability when theta_1 is not fixed; another shows a similar phenomenon when lambda*tau is large (thus we need the two-step MLE). 
      Results from it is saved in file Example_MLE_2step_for_large_lambda.RData.
  example_plot.R: Used to generate the Fig 1 and Fig 2 in the paper.
       Fig 2 is saved in example_plot.pdf.

  HulC_plot.R: main function to draw the fitted curves of MLE, Init and PT estimates and their 90% HulC band/credible band in (one of) the settings. 
  HulC_plot_simu_all.R: automatically conducts all plottings correspond to the previous file with different settings and generate the plots .
    Results from them is saved as HulC_Simu_unif.pdf and the others in the same folder.

  
## Explanation of R Data file

#### Under SIMU folder:
  Table1_unif_K=100.RData and so on: results of Simu1.R and Simu1_Table.R.
  HulC_Cov_unif With No. Auction = 100.RData and so on: results of Simu2_HulC_Coverage.R and Simu2_Table.R.
  Table1_unif_Lbd=10.RData and so on: results of Simu1_2_morebidder.R and Simu1_2_Table.R

#### Under plots folder:
  Example_MLE_2step_for_large_lambda.RData: results of Instability_Boundary_Correction.R

#### Under Empirical folder:
  Xbox_7day_auctions.csv Original dataset after the tie-breaking procedure.
  Xbox_7day_auctions.RData: dataset we used, produced by XBOX_Pre.R

  Xbox_simu_0.5.RData and Xbox_simu_0.67.RData: results of MSE_selling_price.R
  Xbox_simu_dist.RData: result of dis_selling_price.R
  

